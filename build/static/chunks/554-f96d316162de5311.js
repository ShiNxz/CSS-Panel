"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[554],{9779:function(e,n,a){var t=a(1840),s=a(7040),r=a(964),i=a(7743),l=a(8826),o=a(9954),d=a(776);n.Z=e=>{let{open:n,children:a,action:c,handleClose:u,isLoading:m,actionText:h}=e;return(0,t.jsx)(s.R,{isOpen:n,onOpenChange:!m&&u||void 0,classNames:{backdrop:"z-[20000]",wrapper:"z-[20000]"},children:(0,t.jsx)(r.A,{children:e=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.k,{className:"flex flex-col gap-1",children:"Confirmation"}),(0,t.jsx)(l.I,{children:a}),(0,t.jsxs)(o.R,{children:[(0,t.jsx)(d.A,{color:"primary",variant:"light",onPress:e,isLoading:m,children:"Cancel"}),(0,t.jsx)(d.A,{color:"primary",onPress:c,isLoading:m,children:h||"Confirm"})]})]})})})}},9325:function(e,n,a){a.d(n,{Z:function(){return c}});var t=a(1840),s=a(7100),r=a(2819),i=a(4838),l=a(4740),o=(e,n)=>{(0,l.useEffect)(()=>{let a=a=>{let t=null==e?void 0:e.current;!t||t.contains(a.target)||n(a)};return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}},[e,n])},d=a(2523),c=e=>{let{open:n,x:a,y:c,handleCloseMenu:u,items:m}=e,h=(0,l.useRef)(null);return o(h,u),n&&(0,t.jsx)(d.E.div,{className:"w-full max-w-[260px] border-small px-1 py-0.5 rounded-small bg-background/40 backdrop-blur-lg border-default-200 absolute z-[20000]",style:{left:a,top:c},ref:h,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.08},children:(0,t.jsx)(s.X,{variant:"flat","aria-label":"Listbox menu with sections",items:m,children:m.map(e=>{let{category:n,items:a}=e;return(0,t.jsx)(r.y,{title:n,children:a.map(e=>{let{key:n,description:a,icon:s,color:r,onClick:l}=e;return(0,t.jsx)(i.R,{description:(0,t.jsx)("span",{className:"text-foreground-700",children:a}),startContent:(0,t.jsx)(s,{}),color:r||"default",onClick:()=>{l&&l(),u()},children:n},n)})},n)})})})}},2554:function(e,n,a){a.r(n),a.d(n,{default:function(){return J}});var t=a(1840),s=a(1174),r=a(6374),i=a(995),l=a(6637),o=a(181),d=a(8332),c=a(1160),u=a(7890),m=a(2281),h=a(4591),x=a(4740),j=a(3691),p=a(3186),v=a(7917),b=a(8659),g=a(1318),f=a(776),y=a(7463),w=a(5023),N=a(8639),C=a(175),_=a(917),P=e=>{switch(e){case"ACTIVE":return(0,t.jsx)(w.z,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Active"});case"EXPIRED":return(0,t.jsx)(w.z,{color:"success",size:"sm",variant:"flat",radius:"sm",children:"Expired"});case"UNBANNED":return(0,t.jsx)(w.z,{color:"secondary",size:"sm",variant:"flat",radius:"sm",children:"Removed"});default:return(0,t.jsx)(w.z,{color:"secondary",size:"sm",variant:"flat",radius:"sm",children:"Unknown"})}},z=a(3910),A=a(4631),D=a(646),Z=a(9325),R=a(9779),L=a(1916),E=a(2573),T=a(5549),k=a(5370),S=a(7670),I=a(7040),M=a(964),Y=a(7743),B=a(8826),X=a(9954),F=a(1326);let U=F.z.object({player_steamid:F.z.string().optional(),player_ip:F.z.string().optional(),reason:F.z.string().min(3),duration:F.z.string(),comment:F.z.string().optional()});var O=e=>{let{open:n,setOpen:a,mutate:s}=e,[r,i]=(0,x.useState)(!1),l=async()=>{if(!r){i(!0);try{await (0,L.Z)("/api/bans",{method:"POST",data:o.values}),await s(),E.Am.success("Succesfully banned player!"),a(!1)}catch(a){var e;let n=(null==a?void 0:null===(e=a.response)||void 0===e?void 0:e.data)||(null==a?void 0:a.message);console.error(a),E.Am.error("Failed to create ban!\n".concat(n||a))}i(!1)}},o=(0,k.c)({initialValues:{player_steamid:"",player_ip:"",reason:"",duration:"",comment:""},validate:(0,S.F)(U)});return(0,t.jsx)(I.R,{isOpen:n,onOpenChange:r?void 0:a,children:(0,t.jsx)(M.A,{children:e=>(0,t.jsxs)("form",{onSubmit:o.onSubmit(l),children:[(0,t.jsx)(Y.k,{className:"flex flex-col gap-1",children:"Create new ban"}),(0,t.jsxs)(B.I,{children:[(0,t.jsx)("p",{children:"You can ban a player by either their Steam64 / SteamId / Profile URL or their IP address."}),(0,t.jsx)(y.Y,{...o.getInputProps("player_steamid"),errorMessage:o.errors.player_steamid,label:"Player Steam64 / SteamId / Profile URL",placeholder:"7656XXXXXX",variant:"bordered",isDisabled:r||!!o.values.player_ip,autoFocus:!0}),(0,t.jsx)(y.Y,{...o.getInputProps("player_ip"),errorMessage:o.errors.player_ip,label:"IP Address",placeholder:"1.1.1.1",variant:"bordered",isDisabled:r||!!o.values.player_steamid}),(0,t.jsx)(y.Y,{...o.getInputProps("reason"),errorMessage:o.errors.reason,label:"Reason (min 3 characters)",placeholder:"Cheating / Griefing / Toxicity / etc.",variant:"bordered",isDisabled:r}),(0,t.jsx)(y.Y,{...o.getInputProps("duration"),errorMessage:o.errors.duration,label:"Duration in minutes",placeholder:"for example, 60",description:"0 for permanent",variant:"bordered",type:"number",isDisabled:r}),(0,t.jsx)(y.Y,{...o.getInputProps("comment"),errorMessage:o.errors.comment,label:"Comment (optional)",variant:"bordered",isDisabled:r}),(0,t.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,t.jsxs)("span",{children:["The ban will start now ",(0,t.jsxs)("b",{children:["(",(0,T.Z)(),")"]})]}),(0,t.jsxs)("span",{children:["and will end at"," ",(0,t.jsx)("b",{children:"0"===o.values.duration?(0,t.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,T.Z)(new Date().getTime()+6e4*Number(o.values.duration))})]})]})]}),(0,t.jsxs)(X.R,{children:[(0,t.jsx)(f.A,{color:"danger",variant:"flat",onPress:e,isDisabled:r,children:"Cancel"}),(0,t.jsx)(f.A,{color:"primary",type:"submit",isLoading:r,children:"Ban player"})]})]})})})};let V=(0,a(8787).Ue)(e=>({action:null,setAction:n=>e({action:n}),isLoading:!1,setIsLoading:n=>e({isLoading:n}),details:null,setDetails:n=>e({details:n}),reset:()=>e({action:null,isLoading:!1,details:null})}));F.z.object({reason:F.z.string()}),F.z.object({reason:F.z.string(),duration:F.z.string()}),F.z.object({comment:F.z.string()}),F.z.object({reason:F.z.string(),duration:F.z.string()}),F.z.enum(["unban","reban","comment","edit","delete"]);var J=e=>{var n;let{type:a}=e,[k,S]=(0,x.useState)(!1),[I,M]=(0,x.useState)(1),Y=10;"/"===(0,g.usePathname)()&&(Y=5);let{data:B,isLoading:X,mutate:F}=(0,_.ZP)("/api/bans?page=".concat(I,"&rows=").concat(Y),C.Z,{keepPreviousData:!0}),U=(0,x.useMemo)(()=>(null==B?void 0:B.count)?Math.ceil(B.count/Y):0,[null==B?void 0:B.count,Y]),{admin:J}=(0,D.ZP)(),{x:W,y:G,open:H,handleCloseMenu:q,handleOpen:K,info:Q}=(0,A.Z)(),$=V(e=>e.action),ee=V(e=>e.setAction),en=V(e=>e.details),ea=V(e=>e.setDetails),et=V(e=>e.isLoading),es=V(e=>e.setIsLoading),er=V(e=>e.reset),ei=async()=>{if($&&!et&&Q){es(!0);try{await L.Z.post("/api/bans/".concat(Q.id),{action:$,details:en}),await F(),er(),E.ZP.success("Player ".concat($,"ed successfully"))}catch(e){E.ZP.error("Error ".concat($," player"))}es(!1)}},el=(e,n)=>{var a,s,r,i;switch(n){case"player_name":return(0,t.jsx)(z.default,{href:"https://steamcommunity.com/profiles/".concat(e.player_steamid),target:"_blank",passHref:!0,children:(0,t.jsx)(N.z,{avatarProps:{radius:"lg",src:e.player_avatar||""},name:e.player_name,children:null===(a=e.player_name)||void 0===a?void 0:a.slice(0,10)})});case"status":return P(e.status);case"reason":return e.reason.length>10?(0,t.jsx)(b.e,{content:e.reason,showArrow:!0,children:(0,t.jsx)("div",{className:"text-xs font-light",children:e.reason.slice(0,10)})}):(0,t.jsx)("div",{className:"text-xs font-light",children:e.reason});case"unban_reason":return e.unban_reason&&e.unban_reason.length>10?(0,t.jsx)(b.e,{content:e.unban_reason,showArrow:!0,children:(0,t.jsx)("div",{className:"text-xs font-light",children:null===(s=e.unban_reason)||void 0===s?void 0:s.slice(0,10)})}):(0,t.jsx)("div",{className:"text-xs font-light",children:e.unban_reason});case"duration":return(0,t.jsx)(w.z,{color:"primary",size:"sm",variant:"flat",radius:"sm",children:0===e.duration?"Permanent":"".concat(e.duration," minutes")});case"admin_name":return e.admin_name?"Console"===e.admin_name?(0,t.jsx)(w.z,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Console"}):(0,t.jsx)(z.default,{href:"https://steamcommunity.com/profiles/".concat(e.admin_steamid),target:"_blank",passHref:!0,children:(0,t.jsx)(N.z,{avatarProps:{radius:"lg",src:e.admin_avatar||""},name:e.admin_name,children:e.admin_name})}):(0,t.jsx)(t.Fragment,{children:"-"});case"timeLeft":if(0===e.duration)return(0,t.jsx)(w.z,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Permanent"});if("UNBANNED"===e.status||"EXPIRED"===e.status)return(0,t.jsx)(p.W,{color:"success",value:100,isStriped:!0});let l=new Date,o=new Date(e.created),d=new Date(e.ends),c=Math.round((l.getTime()-o.getTime())/(d.getTime()-o.getTime())*100),u=Math.round((d.getTime()-l.getTime())/6e4),m=c<50?"warning":c>=100?"success":"primary";return u>0?(0,t.jsx)(b.e,{content:"".concat(u," minutes left"),color:m,showArrow:!0,children:(0,t.jsx)(p.W,{color:m,value:c,isStriped:!0})}):(0,t.jsx)(p.W,{color:m,value:c,isStriped:!0});case"comment":return e.comment?e.comment.length>10?(0,t.jsx)(b.e,{content:e.comment,showArrow:!0,children:(0,t.jsx)("div",{className:"text-xs font-light",children:null===(r=e.comment)||void 0===r?void 0:r.slice(0,10)})}):(0,t.jsx)("div",{className:"text-xs font-light",children:null===(i=e.comment)||void 0===i?void 0:i.slice(0,10)}):(0,t.jsx)(t.Fragment,{children:"-"});default:return(0,t.jsx)(t.Fragment,{})}},eo=(0,t.jsxs)(s.J,{children:[(0,t.jsx)(r.j,{children:"Player"},"player_name"),(0,t.jsx)(r.j,{children:"Status"},"status"),(0,t.jsx)(r.j,{children:"Admin"},"admin_name"),(0,t.jsx)(r.j,{children:"Reason"},"reason"),(0,t.jsx)(r.j,{children:"Remove Reason"},"unban_reason"),(0,t.jsx)(r.j,{children:"Duration"},"duration"),(0,t.jsx)(r.j,{children:"Time left"},"timeLeft"),(0,t.jsx)(r.j,{children:"Comment"},"comment")]});switch(a){case"MANAGE":eo=(0,t.jsxs)(s.J,{children:[(0,t.jsx)(r.j,{children:"Player"},"player_name"),(0,t.jsx)(r.j,{children:"Status"},"status"),(0,t.jsx)(r.j,{children:"Admin"},"admin_name"),(0,t.jsx)(r.j,{children:"Reason"},"reason"),(0,t.jsx)(r.j,{children:"Remove Reason"},"unban_reason"),(0,t.jsx)(r.j,{children:"Duration"},"duration"),(0,t.jsx)(r.j,{children:"Time left"},"timeLeft"),(0,t.jsx)(r.j,{children:"Comment"},"comment")]});break;case"SMALL":eo=(0,t.jsxs)(s.J,{children:[(0,t.jsx)(r.j,{children:"Player"},"player_name"),(0,t.jsx)(r.j,{children:"Status"},"status"),(0,t.jsx)(r.j,{children:"Reason"},"reason"),(0,t.jsx)(r.j,{children:"Duration"},"duration"),(0,t.jsx)(r.j,{children:"Time left"},"timeLeft")]});break;case"NORMAL":eo=(0,t.jsxs)(s.J,{children:[(0,t.jsx)(r.j,{children:"Player"},"player_name"),(0,t.jsx)(r.j,{children:"Status"},"status"),(0,t.jsx)(r.j,{children:"Admin"},"admin_name"),(0,t.jsx)(r.j,{children:"Reason"},"reason"),(0,t.jsx)(r.j,{children:"Remove Reason"},"unban_reason"),(0,t.jsx)(r.j,{children:"Duration"},"duration"),(0,t.jsx)(r.j,{children:"Time left"},"timeLeft")]})}return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.b,{topContent:(0,t.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,t.jsxs)("div",{className:"text-start",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Bans"}),(0,t.jsxs)("code",{className:"text-sm font-normal",children:["total: ",(null==B?void 0:B.count)||""]})]}),J&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(f.A,{size:"sm",variant:"flat",color:"primary",onClick:()=>S(!0),children:[(0,t.jsx)(c.Z,{}),"New ban"]}),(0,t.jsx)(O,{open:k,setOpen:S,mutate:F})]})]}),bottomContent:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex w-full justify-center",children:(0,t.jsx)(j.g,{color:"primary",page:I,total:U,onChange:e=>M(e),size:"sm",isCompact:!0,showControls:!0,showShadow:!0})}),J&&"MANAGE"===a&&(0,t.jsx)("span",{className:"text-sm",children:"Tip, your can right click on a player row for more actions"})]}),children:[eo,(0,t.jsx)(l.y,{items:null!==(n=null==B?void 0:B.results)&&void 0!==n?n:[],loadingContent:(0,t.jsx)(v.c,{}),loadingState:X?"loading":"idle",children:e=>(0,t.jsx)(o.g,{onContextMenu:n=>J&&K&&K(n,e)||void 0,children:n=>(0,t.jsx)(d.X,{children:el(e,n)})},e.id)})]}),J&&(0,t.jsx)(Z.Z,{open:H,x:W,y:G,handleCloseMenu:q,items:[{category:"Ban Actions",items:[{key:"Comment",description:"Write a comment on this ban, this will be visible to other admins",icon:u.Z,color:"default",onClick:()=>{ee("comment"),ea({comment:(null==Q?void 0:Q.comment)||""})}},{key:(null==Q?void 0:Q.status)==="UNBANNED"||(null==Q?void 0:Q.status)==="EXPIRED"?"Reban":"Remove Ban (shorten)",description:(null==Q?void 0:Q.status)==="UNBANNED"||(null==Q?void 0:Q.status)==="EXPIRED"?"Reban the player":"Remove the player ban (shorten the duration)",icon:m.Z,color:"default",onClick:()=>{(null==Q?void 0:Q.status)==="UNBANNED"||(null==Q?void 0:Q.status)==="EXPIRED"?(ee("reban"),ea({reason:"",duration:"0"})):(ee("unban"),ea({reason:""}))}},{key:"Edit Ban",description:"Edit the ban duration or reason",icon:u.Z,color:"primary",onClick:()=>{var e;ee("edit"),ea({reason:(null==Q?void 0:Q.reason)||"",duration:(null==Q?void 0:null===(e=Q.duration)||void 0===e?void 0:e.toString())||"0"})}},{key:"Delete Ban",description:"Delete the ban from the database (permanent action)",icon:h.Z,color:"danger",onClick:()=>{ee("delete")}}]}]}),J&&(0,t.jsxs)(R.Z,{open:"comment"===$,handleClose:er,action:ei,isLoading:et,actionText:"Save",children:[(0,t.jsx)("div",{children:"Write a comment on this ban, this will be visible to other admins"}),(0,t.jsx)(y.Y,{label:"Comment",value:(null==en?void 0:en.comment)||"",onValueChange:e=>ea({comment:e})})]}),J&&(0,t.jsxs)(R.Z,{open:"unban"===$,handleClose:er,action:ei,isLoading:et,actionText:"Unban",children:[(0,t.jsx)("div",{children:"You sure you want to unban the user?"}),(0,t.jsx)(y.Y,{label:"Reason",value:(null==en?void 0:en.reason)||"",onValueChange:e=>ea({reason:e})})]}),J&&(0,t.jsxs)(R.Z,{open:"reban"===$,handleClose:er,action:ei,isLoading:et,actionText:"Reban",children:[(0,t.jsx)("div",{children:"You sure you want to reban the user?"}),(0,t.jsx)(y.Y,{label:"Reason",value:(null==en?void 0:en.reason)||"",onValueChange:e=>ea({...en,reason:e})}),(0,t.jsx)(y.Y,{label:"Time (in minutes)",type:"number",value:(null==en?void 0:en.duration)||"",onValueChange:e=>ea({...en,duration:e}),description:"Time in minutes, 0 = Permanent ban"}),(0,t.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,t.jsxs)("span",{children:["The ban will start again at ",(0,t.jsx)("b",{children:(0,T.Z)()})]}),(0,t.jsxs)("span",{children:["the ban will end at"," ",(0,t.jsx)("b",{children:(null==en?void 0:en.duration)==="0"?(0,t.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,T.Z)(new Date().getTime()+6e4*Number(null==en?void 0:en.duration))})]})]})]}),J&&(0,t.jsxs)(R.Z,{open:"edit"===$,handleClose:er,action:ei,isLoading:et,actionText:"Edit",children:[(0,t.jsx)("div",{children:"This will replace the ban duration or reason"}),(0,t.jsx)(y.Y,{label:"Ban Reason",value:(null==en?void 0:en.reason)||"",onValueChange:e=>ea({...en,reason:e})}),(0,t.jsx)(y.Y,{label:"Ban Time (in minutes)",type:"number",value:(null==en?void 0:en.duration)||"",onValueChange:e=>ea({...en,duration:e}),description:"Time in minutes, this will be added to the current duration, 0 = Permanent ban (will replace the duration)"}),(0,t.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,t.jsxs)("span",{children:["The ban started at ",(0,t.jsx)("b",{children:(0,T.Z)(null==Q?void 0:Q.created)})]}),(0,t.jsxs)("span",{children:["After the edit, the ban will end at"," ",(0,t.jsx)("b",{children:(null==en?void 0:en.duration)==="0"?(0,t.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,T.Z)(new Date((null==Q?void 0:Q.created)||"").getTime()+6e4*Number(null==en?void 0:en.duration))})]})]})]}),J&&(0,t.jsx)(R.Z,{open:"delete"===$,handleClose:er,action:ei,isLoading:et,actionText:"Delete",children:(0,t.jsx)("div",{children:"Are you sure you want to delete the ban? this action is permanent and cannot be undone"})})]})}},175:function(e,n,a){var t=a(1916);n.Z=e=>t.Z.get(e).then(e=>e.data)},5549:function(e,n){n.Z=e=>{let n=e?new Date(e):new Date;return n.toLocaleDateString()+" - "+n.toLocaleTimeString()}},646:function(e,n,a){a.d(n,{hY:function(){return l},jc:function(){return o}});var t=a(2573),s=a(917),r=a(175),i=a(1916);let l=async()=>{await (0,i.Z)("/api/auth/logout"),await (0,s.JG)("/api/auth"),t.Am.success("Logged out successfully")},o=()=>{let e=window.innerWidth/2-300,n=window.innerHeight/2-400,a=window.open("/api/auth/login/","","toolbar=no, location=no, directories=no, status=no, menubar=no, \n		  scrollbars=no, resizable=yes, copyhistory=no, width=".concat(600,", \n		  height=").concat(800,", top=").concat(n,", left=").concat(e)),r=setInterval(async()=>{a&&a.closed&&(await (0,s.JG)("/api/auth"),t.Am.success("Logged in successfully!"),clearInterval(r))},1e3)};n.ZP=()=>{let{data:e,isLoading:n,error:a}=(0,s.ZP)("/api/auth",r.Z);return e&&e.admin&&e.admin.group&&(e.admin.flags=e.admin.group.flags,e.admin.immunity=e.admin.group.immunity),{user:a||!e?null:e.user,admin:a||!e?null:e.admin,isLoading:n}}},4631:function(e,n,a){var t=a(4740);n.Z=()=>{let[e,n]=(0,t.useState)({open:!1,x:0,y:0,info:void 0});return{x:e.x,y:e.y,open:e.open,handleCloseMenu:()=>{n({...e,open:!1})},handleOpen:(e,a)=>{e.preventDefault();let{pageX:t,pageY:s}=e;n({open:!0,x:t,y:s,info:a})},info:e.info}}}}]);