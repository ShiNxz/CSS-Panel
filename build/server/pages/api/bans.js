"use strict";(()=>{var e={};e.id=9074,e.ids=[9074],e.modules={429:e=>{e.exports=require("cookie-session")},62418:e=>{e.exports=require("mysql2/promise")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3511:e=>{e.exports=require("passport")},53686:e=>{e.exports=require("passport-steam")},48612:e=>{e.exports=require("zod-validation-error")},99648:e=>{e.exports=import("axios")},97564:e=>{e.exports=import("chalk")},45616:e=>{e.exports=import("next-connect")},2782:e=>{e.exports=import("steam-api-sdk")},9926:e=>{e.exports=import("zod")},17049:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{config:()=>d,default:()=>u,routeModule:()=>m});var s=t(88667),n=t(25828),i=t(38051),l=t(89088),o=e([l]);l=(o.then?(await o)():o)[0];let u=(0,i.l)(l,"default"),d=(0,i.l)(l,"config"),m=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/bans",pathname:"/api/bans",bundlePath:"",filename:""},userland:l});r()}catch(e){r(e)}})},89088:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{default:()=>y});var s=t(2782),n=t(6995),i=t(74186),l=t(8909),o=t(77028),u=t(59788),d=t(73153),m=t(58111),c=t(46634),p=e([s,n,i,l,o,u,d,m,c]);[s,n,i,l,o,u,d,m,c]=p.then?(await p)():p;let y=async(e,a)=>{await i.Z.run(e,a);let{method:t}=e;switch(t){case"GET":{let{page:t,rows:r}=l.Z.parse(e.query),s=await (0,o.Z)(e),i=!!await n.Z.settings.getByKey("showAdminName",!1)||!!s,d=await n.Z.bans.getAll(t,r),m=await n.Z.bans.count(),c=[...d.map(e=>e.player_steamid),...d.map(e=>e.admin_steamid)].filter(e=>!!e),p=await (0,u.Z)(c),y=(await Promise.all(d.map(async e=>{let{admin_name:a,admin_steamid:t,created:r,duration:n,ends:l,id:o,reason:u,status:d,player_name:m,player_steamid:c,server_id:y,comment:g,unban_reason:f,player_ip:w}=e;return{admin_name:i?a:null,admin_steamid:i?t:null,admin_avatar:p.find(e=>e.steamid===t)?.avatar||null,created:r,duration:n,ends:l,id:o,reason:u,status:d,player_name:m,player_steamid:c,player_avatar:p.find(e=>e.steamid===c)?.avatar||null,server_id:y,comment:s?g:null,unban_reason:s?f:null,player_ip:w}}))).filter(e=>!!e);return a.status(200).json({results:y,count:m})}case"POST":try{let t=await (0,d.Z)(e,a);if(!t)return;let{player_steamid:r,player_ip:i,reason:l,duration:o,comment:u}=m.Z.parse(e.body),p=null;if(r&&!(p=await (0,s.GetSteamUser)(r)))return a.status(400).send("Invalid player_steamid");let y=new Date,g=new Date(y.getTime()+6e4*Number(o)),f=t.player_name,w=t.player_steamid;return await n.Z.bans.create({player_name:p?p.personaname:null,player_steamid:p?p.steamid:null,player_ip:i||null,reason:l,duration:Number(o),comment:u,admin_steamid:w,admin_name:f,created:y,ends:g}),(0,c.Z)("Ban Create",`Admin ${e.user?.displayName} (${e.user?.id}) banned "${p?.personaname}" (${r}) with reason: ${l} and duration: ${o} minutes`,e.user?.id),a.status(201).json({message:"Ban created"})}catch(e){return a.status(400).json({error:e})}}};r()}catch(e){r(e)}})},59788:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>i});var s=t(2782),n=e([s]);s=(n.then?(await n)():n)[0];let i=async e=>{let a=[...new Set(e)].filter(e=>!isNaN(Number(e)));return a.length&&await (0,s.From64ToUser)(a)||[]};r()}catch(e){r(e)}})},77028:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>i});var s=t(6995),n=e([s]);s=(n.then?(await n)():n)[0];let i=async e=>{if(!e.user)return!1;let a=e.user.id;return!!await s.Z.admins.getBySteam64(a)};r()}catch(e){r(e)}})},46634:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>l});var s=t(6995),n=t(899),i=e([s,n]);[s,n]=i.then?(await i)():i;let l=async(e,a,t)=>{try{s.Z.logs.create(e,a,t);let r=await s.Z.settings.getByKey("discordWebhook",!1);r&&(0,n.Z)({url:r,embeds:[{title:`**▬▬▬▬▬ [LOG :: ${e}] ▬▬▬▬▬**`,color:5352959,description:a,timestamp:new Date().toISOString()}]})}catch(e){error(`Failed to log: ${e}`)}};r()}catch(e){r(e)}})},73153:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>i});var s=t(6995),n=e([s]);s=(n.then?(await n)():n)[0];let i=(e,a,t,r="AND")=>new Promise(async(n,i)=>{if(!e.user)return i(a.status(400).json({success:!1,error:"Protected Route"}));let l=e.user.id,o=await s.Z.admins.getBySteam64(l);if(!o)return i(a.status(401).json({success:!1,error:"Protected Route"}));if(!t)return n(o);let u=null;if("object"==typeof o.flags)u=o.flags;else{let e=await s.Z.adminGroups.getById(o.flags);e&&(u=e.flags)}if(null===u||!("AND"===r?t.every(e=>u.includes(e)):t.some(e=>u.includes(e))))return i(a.status(403).json({success:!1,error:"Protected Route"}));n(o)});r()}catch(e){r(e)}})},58111:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>i});var s=t(9926),n=e([s]);let i=(s=(n.then?(await n)():n)[0]).z.object({player_steamid:s.z.string().optional(),player_ip:s.z.string().optional(),reason:s.z.string().min(3),duration:s.z.string(),comment:s.z.string().optional()});r()}catch(e){r(e)}})},8909:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>i});var s=t(9926),n=e([s]);let i=(s=(n.then?(await n)():n)[0]).default.object({page:s.default.string().default("1").refine(e=>!isNaN(Number(e)),{message:"Invalid page query"}).transform(e=>Number(e)),rows:s.default.string().default("10").refine(e=>!isNaN(Number(e)),{message:"Invalid page query"}).refine(e=>50>Number(e),{message:"Rows must be less than 50"}).transform(e=>Number(e)),query:s.default.string().optional()});r()}catch(e){r(e)}})}};var a=require("../../webpack-api-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[2546],()=>t(17049));module.exports=r})();