"use strict";(()=>{var e={};e.id=2361,e.ids=[2361],e.modules={429:e=>{e.exports=require("cookie-session")},62418:e=>{e.exports=require("mysql2/promise")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3511:e=>{e.exports=require("passport")},53686:e=>{e.exports=require("passport-steam")},48612:e=>{e.exports=require("zod-validation-error")},99648:e=>{e.exports=import("axios")},97564:e=>{e.exports=import("chalk")},45616:e=>{e.exports=import("next-connect")},2782:e=>{e.exports=import("steam-api-sdk")},9926:e=>{e.exports=import("zod")},92832:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>m,default:()=>l,routeModule:()=>d});var s=a(88667),i=a(25828),n=a(38051),u=a(90153),o=e([u]);u=(o.then?(await o)():o)[0];let l=(0,n.l)(u,"default"),m=(0,n.l)(u,"config"),d=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/mutes",pathname:"/api/mutes",bundlePath:"",filename:""},userland:u});r()}catch(e){r(e)}})},90153:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>y});var s=a(2782),i=a(6995),n=a(74186),u=a(8909),o=a(77028),l=a(59788),m=a(73153),d=a(54144),c=a(46634),p=e([s,i,n,u,o,l,m,d,c]);[s,i,n,u,o,l,m,d,c]=p.then?(await p)():p;let y=async(e,t)=>{await n.Z.run(e,t);let{method:a}=e;switch(a){case"GET":{let{page:a,rows:r}=u.Z.parse(e.query),s=await (0,o.Z)(e),n=!!await i.Z.settings.getByKey("showAdminName",!1)||!!s,m=await i.Z.mutes.getAll(a,r),d=await i.Z.mutes.count(),c=[...m.map(e=>e.player_steamid),...m.map(e=>e.admin_steamid)].filter(e=>!!e),p=await (0,l.Z)(c),y=(await Promise.all(m.map(async e=>{let{admin_name:t,admin_steamid:a,created:r,duration:i,ends:u,id:o,reason:l,status:m,player_name:d,player_steamid:c,server_id:y,type:f,comment:g,unmute_reason:w}=e;return{admin_name:n?t:null,admin_steamid:n?a:null,admin_avatar:p.find(e=>e.steamid===a)?.avatar||null,created:r,duration:i,ends:u,id:o,reason:l,status:m,player_name:d,player_steamid:c,player_avatar:p.find(e=>e.steamid===c)?.avatar||null,server_id:y,comment:s?g:null,unmute_reason:s?w:null,type:f}}))).filter(e=>!!e);return t.status(200).json({results:y,count:d})}case"POST":try{let a=await (0,m.Z)(e,t);if(!a)return;let{player_steamid:r,reason:n,duration:u,comment:o,type:l}=d.Z.parse(e.body),p=await (0,s.GetSteamUser)(r);if(!p)return t.status(400).send("Invalid player_steamid");let y=new Date,f=new Date(y.getTime()+6e4*Number(u)),g=a.player_name,w=a.player_steamid;return await i.Z.mutes.create({player_name:p.personaname,player_steamid:r,reason:n,duration:Number(u),comment:o,admin_steamid:w,admin_name:g,created:y,ends:f,type:l}),(0,c.Z)("Mute Create",`Admin ${e.user?.displayName} (${e.user?.id}) muted "${p?.personaname}" (${r}) with reason: ${n} and duration: ${u} minutes`,e.user?.id),t.status(201).json({message:"Mute created"})}catch(e){return t.status(400).json({error:e})}}};r()}catch(e){r(e)}})},59788:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>n});var s=a(2782),i=e([s]);s=(i.then?(await i)():i)[0];let n=async e=>{let t=[...new Set(e)].filter(e=>!isNaN(Number(e)));return t.length&&await (0,s.From64ToUser)(t)||[]};r()}catch(e){r(e)}})},77028:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>n});var s=a(6995),i=e([s]);s=(i.then?(await i)():i)[0];let n=async e=>{if(!e.user)return!1;let t=e.user.id;return!!await s.Z.admins.getBySteam64(t)};r()}catch(e){r(e)}})},46634:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>u});var s=a(6995),i=a(899),n=e([s,i]);[s,i]=n.then?(await n)():n;let u=async(e,t,a)=>{try{s.Z.logs.create(e,t,a);let r=await s.Z.settings.getByKey("discordWebhook",!1);r&&(0,i.Z)({url:r,embeds:[{title:`**▬▬▬▬▬ [LOG :: ${e}] ▬▬▬▬▬**`,color:5352959,description:t,timestamp:new Date().toISOString()}]})}catch(e){error(`Failed to log: ${e}`)}};r()}catch(e){r(e)}})},73153:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>n});var s=a(6995),i=e([s]);s=(i.then?(await i)():i)[0];let n=(e,t,a,r="AND")=>new Promise(async(i,n)=>{if(!e.user)return n(t.status(400).json({success:!1,error:"Protected Route"}));let u=e.user.id,o=await s.Z.admins.getBySteam64(u);if(!o)return n(t.status(401).json({success:!1,error:"Protected Route"}));if(!a)return i(o);let l=null;if("object"==typeof o.flags)l=o.flags;else{let e=await s.Z.adminGroups.getById(o.flags);e&&(l=e.flags)}if(null===l||!("AND"===r?a.every(e=>l.includes(e)):a.some(e=>l.includes(e))))return n(t.status(403).json({success:!1,error:"Protected Route"}));i(o)});r()}catch(e){r(e)}})},54144:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{P:()=>n,Z:()=>u});var s=a(9926),i=e([s]);let n=(s=(i.then?(await i)():i)[0]).z.enum(["GAG","MUTE","SILENCE"]),u=s.z.object({player_steamid:s.z.string(),reason:s.z.string().min(3),duration:s.z.string(),comment:s.z.string().optional(),type:n});r()}catch(e){r(e)}})},8909:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>n});var s=a(9926),i=e([s]);let n=(s=(i.then?(await i)():i)[0]).default.object({page:s.default.string().default("1").refine(e=>!isNaN(Number(e)),{message:"Invalid page query"}).transform(e=>Number(e)),rows:s.default.string().default("10").refine(e=>!isNaN(Number(e)),{message:"Invalid page query"}).refine(e=>50>Number(e),{message:"Rows must be less than 50"}).transform(e=>Number(e)),query:s.default.string().optional()});r()}catch(e){r(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[2546],()=>a(92832));module.exports=r})();